generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
//   url      = env("DATABASE_URL")
}

enum ProductStatus {
  ACTIVE
  INACTIVE
  OUT_OF_STOCK
  DISCONTINUED
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING     // Order created, payment not initiated
  INITIATED   // Redirected to payment gateway
  PAID        // Payment successful
  FAILED      // Payment failed
  CANCELLED   // User cancelled payment
  REFUNDED    // Payment refunded
}

enum PaymentMethod {
  CASH_ON_DELIVERY
  SSLCOMMERZ
  BKASH
  NAGAD
  STRIPE
}



enum Role {
  USER
  ADMIN
  VENDOR
  
}

enum InventoryAction {
  STOCK_IN
  STOCK_OUT
  ADJUSTMENT
  RETURN
  DAMAGE
}
enum InventorySource {
  ORDER
  ADMIN
  SYSTEM
  SUPPLIER
}


model Brand {
  id        String    @id @default(uuid())
  name      String    @unique
  slug      String    @unique
  description String?
  country   String?
  logoUrl   String?   // optional logo image URL
  isDeleted Boolean   @default(false)
  deletedAt DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  products  Product[] // relation to Product table

  @@map("brands")
}


model Category {
  id        String     @id @default(uuid())
  name      String
  slug      String     @unique
  parentId  String?
  parent    Category?  @relation("CategoryTree", fields: [parentId], references: [id])
  children  Category[] @relation("CategoryTree")

  isDeleted      Boolean  @default(false)
  deletedAt      DateTime?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  products  Product[]
}

model InventoryLog {
  id              String   @id @default(uuid())

  productId       String
  product         Product @relation(fields: [productId], references: [id])

  variantId       String?
  variant         ProductVariant? @relation(fields: [variantId], references: [id])

  action          InventoryAction
  source          InventorySource?

  quantity        Int      // + or - value
  previousStock   Int?
  currentStock    Int?

  referenceId     String?  // orderId, supplierId, etc
  note            String?

  createdAt       DateTime @default(now())

  @@index([productId])
  @@index([variantId])
}


// model Order {
//   id        String   @id @default(uuid())
//   userId    String?
//   user      User?    @relation(fields: [userId], references: [id])
//   orderNumber     String   @unique
//   customerName    String
//   customerEmail   String
//   customerPhone   String
//   shippingAddress String
//   totalAmount     Float
//   discountAmount  Float    @default(0)
//   shippingAmount  Float    @default(0)
//   finalAmount     Float
//   status          OrderStatus @default(PENDING)
//   trackingNumber  String?
//   notes           String?
//   invoiceUrl      String?
//   paymentMethod String?
// paymentStatus PaymentStatus @default(PENDING)
// payments Payment[]

//   orderitems        OrderItem[]


//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt
// }

// model OrderItem {
//   id          String   @id @default(uuid())
//   quantity    Int
//   // unitPrice   Float
//   totalPrice  Float
  
//   // Relations
//   orderId     String
//   order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
//   productId      String
//   product        Product @relation(fields: [productId], references: [id])
//   createdAt   DateTime @default(now())
  
//   @@unique([orderId, productId])
//   @@map("order_item")
// }





// model Payment {
//   id              String        @id @default(uuid())

//   orderId         String
//   order           Order         @relation(fields: [orderId], references: [id])

//   paymentMethod   PaymentMethod
//   paymentStatus   PaymentStatus @default(PENDING)

//   amount          Float
//   currency        String        @default("BDT")

//   transactionId   String?       @unique   // Gateway transaction ID
//   gatewayResponse Json?

//   paidAt          DateTime?
//   refundedAt      DateTime?

//   createdAt       DateTime      @default(now())
//   updatedAt       DateTime      @updatedAt

//   @@index([orderId])
// }


model Product {
  id            String   @id @default(uuid())
  name          String
  slug          String   @unique

  basePrice     Float?
  salePrice     Float?
  isActive      Boolean  @default(true)

  description   String?
  ingredients   String?
  nutritionInfo Json?
  
  expiryDays    Int?

  categoryId    String
  category      Category @relation(fields: [categoryId], references: [id])

  images        ProductImage[]
  variants      ProductVariant[]
  inventoryLogs  InventoryLog[]
  brandId      String
  brand          Brand? @relation( fields: [brandId], references: [id])

  nutrition     Nutrition?      
  

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}


model Nutrition {
  id          String   @id @default(uuid())
  calories    Float?
  protein     Float?
  carbs       Float?
  fats        Float?
  sugar       Float?
  fiber       Float?
  sodium      Float?
  cholesterol Float?
  vitamins    String? 
  minerals    String? 
  
 
  // âœ… FK lives here
  productId   String   @unique
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}


model ProductImage {
  id        String   @id @default(uuid())
  url       String
  isMain    Boolean  @default(false)

  productId String
  product   Product  @relation(fields: [productId], references: [id])

  createdAt DateTime @default(now())
}

model ProductVariant {
  id        String   @id @default(uuid())
  sku       String   @unique
  price     Float
  stock     Int?
  isDefault Boolean  @default(false)

  productId String
  product   Product  @relation(fields: [productId], references: [id])

  attributes VariantAttribute[]
  inventoryLogs  InventoryLog[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Attribute {
  id     String @id @default(uuid())
  name   String @unique

  values AttributeValue[]
}

model AttributeValue {
  id          String @id @default(uuid())
  value       String

  attributeId String
  attribute   Attribute @relation(fields: [attributeId], references: [id])

  variantAttributes VariantAttribute[]

  @@unique([attributeId, value])
}


model VariantAttribute {
  id               String @id @default(uuid())

  productVariantId String
  productVariant   ProductVariant @relation(fields: [productVariantId], references: [id])

  attributeValueId String
  attributeValue   AttributeValue @relation(fields: [attributeValueId], references: [id])
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  role      Role     @default(USER)

  // orders Order[]

  isDeleted      Boolean  @default(false)
  deletedAt      DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

